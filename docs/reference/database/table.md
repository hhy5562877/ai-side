---
outline: deep
---

# 数据库表与字段

思源在运行时会维护一个 SQLite 数据库用来存储笔记的所有数据, 可以通过 SQL 语句来访问内部数据。以下是数据表的定义格式。

## `blocks`

存储了所有的内容块数据。

| 字段名      | 说明                                               | 字段值示例                                                                 |
| ----------- | -------------------------------------------------- | -------------------------------------------------------------------------- |
| `id`        | 内容块 ID                                          | `20210104091228-d0rzbmm`                                                   |
| `parent_id` | 上级块的 ID，文档块该字段为空                      | `20200825162036-4dx365o`                                                   |
| `root_id`   | 顶层块的 ID，即文档块 ID                           | `20200825162036-4dx365o`                                                   |
| `hash`      | `content` 字段的 SHA256 校验和                     | `a75d25c`                                                                  |
| `box`       | 笔记本 ID                                          | `20210808180117-czj9bvb`                                                   |
| `path`      | 内容块所在文档路径                                 | `/20200812220555-lj3enxa/20210808180320-abz7w6k/20200825162036-4dx365o.sy` |
| `hpath`     | 人类可读的内容块所在文档路径                       | `/0 请从这里开始/编辑器/排版元素`                                          |
| `name`      | 内容块名称                                         | `一级标题命名`                                                             |
| `alias`     | 内容块别名                                         | `一级标题别名`                                                             |
| `memo`      | 内容块备注                                         | `一级标题备注`                                                             |
| `tag`       | 非文档块为块内包含的标签，文档块为文档的标签       | `#标签1# #标签2# #标签3#`                                                  |
| `content`   | 去除了 Markdown 标记符的文本                       | `一级标题`                                                                 |
| `fcontent`  | 第一个子块去除了 Markdown 标记符的文本(1.9.9 添加) | `第一个子块`                                                               |
| `markdown`  | 包含完整 Markdown 标记符的文本                     | `# 一级标题`                                                               |
| `length`    | `fcontent` 字段文本长度                            | `6`                                                                        |
| `type`      | 内容块主类型，参考 [blocks.type](#blocks-type)     | `h`                                                                        |
| `subtype`   | 内容块次类型，参考 [blocks.subtype](#blocks-type)  | `h1`                                                                       |
| `ial`       | 内联属性列表，形如 `{: name="value"}`              | `{: id="20210104091228-d0rzbmm" updated="20210604222535"}`                 |
| `sort`      | 排序权重，数值越小排序越靠前                       | `5`                                                                        |
| `created`   | 创建时间                                           | `20210104091228`                                                           |
| `updated`   | 更新时间                                           | `20210604222535`                                                           |

### `blocks.type`

块主类型

| 字段值        | 说明      |
| ------------- | --------- |
| `audio`       | 音频块    |
| `av`          | 属性表    |
| `b`           | 引述块    |
| `c`           | 代码块    |
| `d`           | 文档块    |
| `h`           | 标题块    |
| `html`        | HTML 块   |
| `i`           | 列表项    |
| `iframe`      | iframe 块 |
| `l`           | 列表块    |
| `m`           | 公式块    |
| `p`           | 段落块    |
| `query_embed` | 嵌入块    |
| `s`           | 超级块    |
| `t`           | 表格块    |
| `tb`          | 分割线    |
| `video`       | 视频块    |
| `widget`      | 挂件块    |

### `blocks.subtype`

块次类型，默认为空字符串

| 字段值 | 关联的 `type` 字段值 | 说明       |
| ------ | -------------------- | ---------- |
| `h1`   | `h`                  | 一级标题块 |
| `h2`   | `h`                  | 二级标题块 |
| `h3`   | `h`                  | 三级标题块 |
| `h4`   | `h`                  | 四级标题块 |
| `h5`   | `h`                  | 五级标题块 |
| `h6`   | `h`                  | 六级标题块 |
| `o`    | `l`                  | 有序列表块 |
| `u`    | `l`                  | 无序列表块 |
| `t`    | `l`                  | 任务列表块 |

## `refs`

存储了所有的引用双链结构。

| 字段名                | 说明                           | 字段值示例                                                                 |
| --------------------- | ------------------------------ | -------------------------------------------------------------------------- |
| `id`                  | 引用 ID                        | `20211127144458-idb32wk`                                                   |
| `def_block_id`        | 被引用块的块 ID                | `20200925095848-aon4lem`                                                   |
| `def_block_parent_id` | 被引用块的双亲节点的块 ID      | `20200905090211-2vixtlf`                                                   |
| `def_block_root_id`   | 被引用块所在文档的 ID          | `20200905090211-2vixtlf`                                                   |
| `def_block_path`      | 被引用块所在文档的路径         | `/20200812220555-lj3enxa/20210808180320-fqgskfj/20200905090211-2vixtlf.sy` |
| `block_id`            | 引用所在内容块 ID              | `20210104090624-c5bu25o`                                                   |
| `root_id`             | 引用所在文档块 ID              | `20200905090211-2vixtlf`                                                   |
| `box`                 | 引用所在笔记本 ID              | `20210808180117-czj9bvb`                                                   |
| `path`                | 引用所在文档块路径             | `/20200812220555-lj3enxa/20210808180320-fqgskfj/20200905090211-2vixtlf.sy` |
| `content`             | 引用锚文本                     | `元类型`                                                                   |
| `markdown`            | 包含完整 Markdown 标记符的文本 | `((20200925095848-aon4lem "元类型"))`                                      |
| `type`                | 引用类型                       | `ref_id`                                                                   |

## `attributes`

| 字段名     | 说明         | 字段值示例                   |
| ---------- | ------------ | ---------------------------- |
| `id`       | 属性 ID      | `20211127144458-h7y55zu`     |
| `name`     | 属性名称     | `bookmark`                   |
| `value`    | 属性值       | `✨`                         |
| `type`     | 类型         | `b`                          |
| `block_id` | 块 ID        | `20210428212840-859h45j`     |
| `root_id`  | 文档 ID      | `20200812220555-lj3enxa`     |
| `box`      | 笔记本 ID    | `20210808180117-czj9bvb`     |
| `path`     | 文档文件路径 | `/20200812220555-lj3enxa.sy` |

## `assets`

资源引用

| 字段名     | 字段值示例                                                         | 说明         |
| ---------- | ------------------------------------------------------------------ | ------------ |
| `id`       | `20211127144458-uinrvpj`                                           | 引用 ID      |
| `block_id` | `20210512171633-u3iy2xx`                                           | 块 ID        |
| `root_id`  | `20200915214115-42b8zma`                                           | 文档 ID      |
| `box`      | `20210808180117-czj9bvb`                                           | 笔记本 ID    |
| `docpath`  | `/20200812220555-lj3enxa/20200915214115-42b8zma.sy`                | 文档路径     |
| `path`     | `assets/siyuan-128-20210604092205-djd749a.png`                     | 资源文件路径 |
| `name`     | `siyuan-128-20210604092205-djd749a.png`                            | 资源文件名   |
| `title`    | `源于思考，饮水思源`                                               | 资源标题     |
| `hash`     | `788c154262194a126b433b1055fbddcf5ada066e0d1f565a54e5550125675075` | 资源哈希值   |

## `file_annotation_refs`

文件 PDF 的注释引用

| 字段名        | 字段值示例                                                        | 说明               |
| ------------- | ----------------------------------------------------------------- | ------------------ |
| id            | `20220110165814-wgit0t4`                                          | 引用 ID            |
| file_path     | `assets/vim-reference-2.3.0 - Wei Zhi-20211230002422-9gbzdu0.pdf` | 关联文件路径       |
| annotation_id | `20220110165331-699dvqv`                                          | 被引用注释 ID      |
| block_id      | `20220110165327-kfadm4z`                                          | 引用所在内容块 ID  |
| root_id       | `20211230002404-5spavgt`                                          | 引用所在文档块 ID  |
| box           | `20210914201520-i0v92g9`                                          | 引用所在笔记本 ID  |
| path          | `/20211230002404-5spavgt.sy`                                      | 引用所在文档块路径 |
| content       | `Vim 中文手册`                                                    | 引用锚文本         |
| type          |                                                                   | 注释类型           |

## `spans`

行内元素

| 字段名     | 字段值示例                                                                                                                                                    | 说明                               |
| ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------- |
| `id`       | `20211127144458-rwt8qka`                                                                                                                                      | 行内元素 ID                        |
| `block_id` | `20210429172522-ceauu94`                                                                                                                                      | 元素所在内容块 ID                  |
| `root_id`  | `20200812220555-lj3enxa`                                                                                                                                      | 元素所在文档块 ID                  |
| `box`      | `20210808180117-czj9bvb`                                                                                                                                      | 元素所在笔记本 ID                  |
| `path`     | `/20200812220555-lj3enxa.sy`                                                                                                                                  | 元素所在文档块路径                 |
| `content`  | `请勿在帮助指南中保存数据`                                                                                                                                    | 元素内容                           |
| `markdown` | `请勿在帮助指南中保存数据`                                                                                                                                    | 包含完整 Markdown 标记符的元素内容 |
| `type`     | 元素类型，参考 [spans.type](#spans-type)                                                                                                                      | 元素类型                           |
| `ial`      | `{: style="background-image: linear-gradient(to right, var(--b3-theme-primary), var(--b3-theme-error)); -webkit-background-clip: text; color: transparent;"}` | 元素样式                           |

### `spans.type`

| 字段值               | 说明     |
| -------------------- | -------- |
| img                  | 图片     |
| tag                  | 文档标签 |
| textmark a           | 链接     |
| textmark block-ref   | 引用     |
| textmark code        | 行内代码 |
| textmark inline-memo | 备注     |
| textmark tag         | #标签#   |
| textmark inline-math | 行内公式 |
| textmark mark        | 高亮标记 |
| textmark em          | HTML tag |
| textmark s           | HTML tag |
| textmark strong      | HTML tag |
| textmark sub         | HTML tag |
| textmark sup         | HTML tag |
| textmark u           | HTML tag |

## `stat`

其他信息

| key                           | value                                                              | 说明                                          |
| ----------------------------- | ------------------------------------------------------------------ | --------------------------------------------- |
| `siyuan_database_ver`         | `20211022`                                                         | 数据库版本                                    |
| `20211127144654-wd72ryx_hash` | `499ec649a66ffb730a90a8a54f8cb266436cea568ff4e4ad9698e0c537f24170` | ID 为 `20211127144654-wd72ryx` 的笔记本的哈希 |
